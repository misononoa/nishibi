<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
    xmlns:nishibi="http://nishibi.misononoa.cc/nishibi">

<head>
    <title th:text="nishibi-bbs"></title>
    <th:block th:replace="~{common::common-head}" />
    <style>
        #newpost-form>form {
            display: flex;
            flex-direction: column;
        }

        #newpost-form>form>div {
            flex: 2;
        }

        #newpost-form textarea[name=text] {
            width: 100%;
            min-height: 4rem;
        }

        article.post-article {
            margin: 2.5rem 0;
        }

        div.post-text>h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            margin: 0.5rem 0;
        }

        div.post-text>h1 {
            font-size: 1.2rem;
        }

        div.post-text>h2 {
            font-size: 1.15rem;
        }

        div.post-text>h3 {
            font-size: 1.1rem;
        }

        div.post-text>h4 {
            font-size: 1.05rem;
        }

        div.post-text>h5,
        h6 {
            font-size: 1rem;
        }

        div.post-text>*:first-child {
            margin-top: 0;
        }

        #pager>ul {
            list-style-type: none;
            padding-left: 0;
        }

        #pager>ul>li {
            display: inline;
            color: var(--linkcolor);
        }
    </style>
</head>

<body>
    <h1 th:text="nishibi-bbs"></h1>
    <main>

        <div id="newpost-form" th:fragment="newpost-form" hx-swap-oob="true">
            <form hx-post="/posts" hx-ext="json-enc" hx-trigger-name="new-post" hx-target="#posts-list"
                autocomplete="off">
                <div>
                    <textarea name="text" autocomplete="off"></textarea>
                </div>
                <div>
                    <input type="submit" value="submit" />
                </div>
            </form>
        </div>
        <hr />

        <div id="posts-list" hx-swap="outerHTML">
            <article th:fragment="post-article" th:each="post : ${posts}" class="post-article">
                <div>
                    <a th:href="@{'/posts/' + ${post.abbrevHash}}" th:text="|#${post.abbrevHash}|"></a>
                    <span th:text="|@${#temporals.format(post.createdAt, 'yyyy-MM-dd hh:mm:ss')}|"></span>
                </div>
                <div class="post-text"
                    nishibi:render="${#strings.length(post.text) gt 120 ? #strings.substring(post.text, 0, 120) + '...' : post.text}">
                </div>
            </article>
        </div>

        <aside id="pager" th:fragment="pager" hx-swap-oob="true">
            <ul>
                <li th:class="${posts.first} ? 'disabled':''">
                    <span th:if="${posts.first}">●</span>
                    <a th:if="${not posts.first}" th:href="@{${'/'}(page=0)}">●</a>
                </li>
                <li th:text="${posts.number}"></li>
                <li th:class="${not posts.hasNext()} ? 'disabled':''">
                    <span th:if="${not posts.hasNext()}">&gt;</span>
                    <a th:if="${posts.hasNext()}" th:href="@{${'/'}(page=(${posts.number}+1))}">&gt;</a>
                </li>
            </ul>
        </aside>

    </main>
    <footer style="font-size: small; color: dimgray;">
        <a href="/credits">このソフトウェアについて</a>
    </footer>
</body>

</html>